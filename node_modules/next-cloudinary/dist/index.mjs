import ne,{useState as ie}from"react";import ae from"next/image";import{getTransformations as de}from"@cloudinary-util/util";import{transformationPlugins as le}from"@cloudinary-util/url-loader";import{constructCloudinaryUrl as re}from"@cloudinary-util/url-loader";import oe from"next/package.json";var k={name:"next-cloudinary",version:"4.3.0",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup src/index.ts --dts",dev:"tsup src/index.ts --watch --dts",prepublishOnly:"cp ../README.md . && yarn build",postpublish:"rm ./README.md",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.1.1","@cloudinary-util/util":"^2.0.1","@cloudinary/url-gen":"^1.8.6"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","@types/jest":"^29.2.0","@types/react":"^18.0.28","@types/react-dom":"^18.0.11","babel-jest":"^29.2.2",dotenv:"^16.0.3",jest:"^29.2.2","jest-environment-jsdom":"^29.2.2","ts-jest":"^29.0.3",tsup:"^6.6.3",typescript:"^4.9.4"},peerDependencies:{next:"^12 || ^13",react:"^17 || ^18"}};var S="V",R=k.version,$=oe.version;function U(e,a,r){return re({options:e,config:Object.assign({cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}},a),analytics:Object.assign({sdkCode:S,sdkSemver:R,techVersion:$,feature:""},r)})}async function V(e){let{src:a}=e;try{await new Promise((r,n)=>{fetch(a).then(o=>{if(!o.ok){n(o);return}r(o)})})}catch(r){return r.status===423?await V(e):!1}return!0}function D({loaderOptions:e,imageProps:a,cldOptions:r,cldConfig:n={}}){let o={...a,...r};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof(e==null?void 0:e.width)=="number"&&typeof o.width=="number"&&e.width!==o.width){let l=e.width/o.width;o.widthResize=e.width,typeof o.height=="number"&&(o.heightResize=Math.round(o.height*l))}return U(o,n)}var se=e=>{let a=["deliveryType","preserveTransformations"];le.forEach(({props:t=[]})=>{t.forEach(i=>{if(a.includes(i))throw new Error(`Option ${i} already exists!`);a.push(i)})});let r={alt:e.alt,src:e.src};Object.keys(e).filter(t=>!a.includes(t)).forEach(t=>r[t]=e[t]);let n=Object.keys(r).map(t=>`${t}:${r[t]}`).join(";"),[o,l]=ie(n),d={};if(a.forEach(t=>{e[t]&&(d[t]=e[t]||void 0)}),e.preserveTransformations)try{let t=de(e.src);d.rawTransformations=[...t.flat(),...e.rawTransformations||[]]}catch(t){console.warn(`Failed to preserve transformations: ${t.message}`)}async function p(t){await V({src:t.target.src})&&l(`${n};${Date.now()}`)}return ne.createElement(ae,{key:o,...r,loader:t=>D({loaderOptions:t,imageProps:r,cldOptions:d}),onError:p})},B=se;import u from"react";import pe from"next/head";var ce=2400,me=1200,ue="summary_large_image",ge=({excludeTags:e=[],twitterTitle:a,keys:r={},...n})=>{let{alt:o}=n,l={...n,crop:n.crop||"fill",gravity:n.gravity||"center",height:n.height||me,src:n.src,width:n.width||ce},d={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...r},p=U(l);return u.createElement(pe,null,u.createElement("meta",{key:d["og:image"],property:"og:image",content:p}),u.createElement("meta",{key:d["og:image:secure_url"],property:"og:image:secure_url",content:p}),u.createElement("meta",{key:d["og:image:width"],property:"og:image:width",content:`${l.width}`}),u.createElement("meta",{key:d["og:image:height"],property:"og:image:height",content:`${l.height}`}),o&&u.createElement("meta",{key:d["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&u.createElement("meta",{key:d["twitter:title"],property:"twitter:title",content:a||" "}),u.createElement("meta",{key:d["twitter:card"],property:"twitter:card",content:ue}),u.createElement("meta",{key:d["twitter:image"],property:"twitter:image",content:p}))},G=ge;import E from"react";import j,{useState as F,useEffect as Y,useRef as H}from"react";import fe from"next/script";function X(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var ye=["success","display-changed"],Ce=({children:e,onClose:a,onError:r,onOpen:n,onUpload:o,options:l,signatureEndpoint:d,uploadPreset:p})=>{let t=H(),i=H(),C=!!d,[h,_]=F(void 0),[m,v]=F(void 0),I={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:p||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...l};C&&(I.uploadSignature=w,I.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),Y(()=>{if(typeof m=="undefined")return;let c=m.event==="success",g=m.event==="display-changed"&&m.info==="hidden";c&&typeof o=="function"&&o(m,i.current),g&&typeof a=="function"&&a(i.current)},[m]),Y(()=>{h&&typeof r=="function"&&r(h,i.current)},[h]);function b(){t.current||(t.current=window.cloudinary),X(()=>{i.current||(i.current=P())})}function w(c,g){if(typeof d=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(d,{method:"POST",body:JSON.stringify({paramsToSign:g})}).then(s=>s.json()).then(({signature:s})=>{c(s)})}function P(){var c;return(c=t.current)==null?void 0:c.createUploadWidget(I,(g,s)=>{typeof g!="undefined"&&_(g),ye.includes(s==null?void 0:s.event)&&v(s)})}function N(){i.current||(i.current=P()),i==null||i.current.open(),typeof n=="function"&&n(i.current)}return j.createElement(j.Fragment,null,typeof e=="function"&&e({cloudinary:t.current,widget:i.current,open:N,results:m,error:h}),j.createElement(fe,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onLoad:b,onError:c=>console.error(`Failed to load Cloudinary Upload Widget: ${c.message}`)}))},x=Ce;var he=({children:e,onClick:a,onError:r,onUpload:n,options:o,signatureEndpoint:l,uploadPreset:d,...p})=>E.createElement(E.Fragment,null,E.createElement(x,{onError:r,onUpload:n,options:o,signatureEndpoint:l,uploadPreset:d},({open:t})=>{function i(C){C.preventDefault(),t(),typeof a=="function"&&a(C)}return E.createElement("button",{...p,onClick:i},e||"Upload")})),K=he;import y,{useRef as L}from"react";import Ie from"next/script";import Pe from"next/head";var Oe=e=>{let a=L(Math.ceil(Math.random()*1e5)),{autoPlay:r="never",colors:n,controls:o=!0,fontFace:l,height:d,id:p,logo:t=!0,loop:i=!1,muted:C=!1,onDataLoad:h,onError:_,onMetadataLoad:m,onPause:v,onPlay:I,onEnded:b,src:w,version:P="1.9.4",width:N}=e,c=L(),g=L(),s=e.videoRef||g,q=L(),A=e.playerRef||q,J=p||`player-${w.replace("/","-")}-${a.current}`,T={error:_,loadeddata:h,loadedmetadata:m,pause:v,play:I,ended:b};function Q(f){let O=T[f.type];typeof O=="function"&&O(ee())}function Z(){if("cloudinary"in window){c.current=window.cloudinary;let f={};typeof t=="boolean"?f.showLogo=t:typeof t=="object"&&(f={...f,showLogo:!0,logoImageUrl:t.imageUrl,logoOnclickUrl:t.onClickUrl});let O={autoplayMode:r,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,controls:o,fontFace:l||"",loop:i,muted:C,publicId:w,secure:!0,...f};typeof n=="object"&&(O.colors=n),A.current=c.current.videoPlayer(s.current,O),Object.keys(T).forEach(W=>{var M;typeof T[W]=="function"&&((M=A.current)==null||M.on(W,Q))})}}function ee(){return{player:A.current,video:s.current}}return y.createElement(y.Fragment,null,y.createElement(Pe,null,y.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${P}/dist/cld-video-player.min.css`,rel:"stylesheet"})),y.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},y.createElement("video",{ref:s,id:J,className:"cld-video-player cld-fluid",width:N,height:d}),y.createElement(Ie,{id:`cloudinary-videoplayer-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${P}/dist/cld-video-player.min.js`,onLoad:Z,onError:f=>console.error(`Failed to load Cloudinary Video Player: ${f.message}`)})))},z=Oe;export{B as CldImage,G as CldOgImage,K as CldUploadButton,x as CldUploadWidget,z as CldVideoPlayer,D as cloudinaryLoader,U as getCldImageUrl};
//# sourceMappingURL=index.mjs.map