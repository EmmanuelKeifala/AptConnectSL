"use strict";var pe=Object.create;var v=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var me=Object.getOwnPropertyNames;var ue=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty;var fe=(e,r)=>{for(var n in r)v(e,n,{get:r[n],enumerable:!0})},X=(e,r,n,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of me(r))!ge.call(e,t)&&t!==n&&v(e,t,{get:()=>r[t],enumerable:!(i=ce(r,t))||i.enumerable});return e};var g=(e,r,n)=>(n=e!=null?pe(ue(e)):{},X(r||!e||!e.__esModule?v(n,"default",{value:e,enumerable:!0}):n,e)),ye=e=>X(v({},"__esModule",{value:!0}),e);var _e={};fe(_e,{CldImage:()=>k,CldOgImage:()=>S,CldUploadButton:()=>R,CldUploadWidget:()=>E,CldVideoPlayer:()=>$,cloudinaryLoader:()=>b,getCldImageUrl:()=>O});module.exports=ye(_e);var N=g(require("react")),J=g(require("next/image")),Q=require("@cloudinary-util/util"),Z=require("@cloudinary-util/url-loader");var q=require("@cloudinary-util/url-loader");var Y=g(require("next/package.json"));var F={name:"next-cloudinary",version:"4.3.0",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup src/index.ts --dts",dev:"tsup src/index.ts --watch --dts",prepublishOnly:"cp ../README.md . && yarn build",postpublish:"rm ./README.md",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.1.1","@cloudinary-util/util":"^2.0.1","@cloudinary/url-gen":"^1.8.6"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","@types/jest":"^29.2.0","@types/react":"^18.0.28","@types/react-dom":"^18.0.11","babel-jest":"^29.2.2",dotenv:"^16.0.3",jest:"^29.2.2","jest-environment-jsdom":"^29.2.2","ts-jest":"^29.0.3",tsup:"^6.6.3",typescript:"^4.9.4"},peerDependencies:{next:"^12 || ^13",react:"^17 || ^18"}};var H="V",K=F.version,z=Y.default.version;function O(e,r,n){return(0,q.constructCloudinaryUrl)({options:e,config:Object.assign({cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}},r),analytics:Object.assign({sdkCode:H,sdkSemver:K,techVersion:z,feature:""},n)})}async function M(e){let{src:r}=e;try{await new Promise((n,i)=>{fetch(r).then(t=>{if(!t.ok){i(t);return}n(t)})})}catch(n){return n.status===423?await M(e):!1}return!0}function b({loaderOptions:e,imageProps:r,cldOptions:n,cldConfig:i={}}){let t={...r,...n};if(t.width=typeof t.width=="string"?parseInt(t.width):t.width,t.height=typeof t.height=="string"?parseInt(t.height):t.height,typeof(e==null?void 0:e.width)=="number"&&typeof t.width=="number"&&e.width!==t.width){let l=e.width/t.width;t.widthResize=e.width,typeof t.height=="number"&&(t.heightResize=Math.round(t.height*l))}return O(t,i)}var he=e=>{let r=["deliveryType","preserveTransformations"];Z.transformationPlugins.forEach(({props:o=[]})=>{o.forEach(a=>{if(r.includes(a))throw new Error(`Option ${a} already exists!`);r.push(a)})});let n={alt:e.alt,src:e.src};Object.keys(e).filter(o=>!r.includes(o)).forEach(o=>n[o]=e[o]);let i=Object.keys(n).map(o=>`${o}:${n[o]}`).join(";"),[t,l]=(0,N.useState)(i),d={};if(r.forEach(o=>{e[o]&&(d[o]=e[o]||void 0)}),e.preserveTransformations)try{let o=(0,Q.getTransformations)(e.src);d.rawTransformations=[...o.flat(),...e.rawTransformations||[]]}catch(o){console.warn(`Failed to preserve transformations: ${o.message}`)}async function m(o){await M({src:o.target.src})&&l(`${i};${Date.now()}`)}return N.default.createElement(J.default,{key:t,...n,loader:o=>b({loaderOptions:o,imageProps:n,cldOptions:d}),onError:m})},k=he;var f=g(require("react")),ee=g(require("next/head"));var Ie=2400,Pe=1200,Oe="summary_large_image",Ue=({excludeTags:e=[],twitterTitle:r,keys:n={},...i})=>{let{alt:t}=i,l={...i,crop:i.crop||"fill",gravity:i.gravity||"center",height:i.height||Pe,src:i.src,width:i.width||Ie},d={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...n},m=O(l);return f.default.createElement(ee.default,null,f.default.createElement("meta",{key:d["og:image"],property:"og:image",content:m}),f.default.createElement("meta",{key:d["og:image:secure_url"],property:"og:image:secure_url",content:m}),f.default.createElement("meta",{key:d["og:image:width"],property:"og:image:width",content:`${l.width}`}),f.default.createElement("meta",{key:d["og:image:height"],property:"og:image:height",content:`${l.height}`}),t&&f.default.createElement("meta",{key:d["og:image:alt"],property:"og:image:alt",content:t}),!e.includes("twitter:title")&&f.default.createElement("meta",{key:d["twitter:title"],property:"twitter:title",content:r||" "}),f.default.createElement("meta",{key:d["twitter:card"],property:"twitter:card",content:Oe}),f.default.createElement("meta",{key:d["twitter:image"],property:"twitter:image",content:m}))},S=Ue;var L=g(require("react"));var s=g(require("react")),oe=g(require("next/script"));function te(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var we=["success","display-changed"],xe=({children:e,onClose:r,onError:n,onOpen:i,onUpload:t,options:l,signatureEndpoint:d,uploadPreset:m})=>{let o=(0,s.useRef)(),a=(0,s.useRef)(),I=!!d,[P,A]=(0,s.useState)(void 0),[y,T]=(0,s.useState)(void 0),U={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:m||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...l};I&&(U.uploadSignature=_,U.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),(0,s.useEffect)(()=>{if(typeof y=="undefined")return;let u=y.event==="success",C=y.event==="display-changed"&&y.info==="hidden";u&&typeof t=="function"&&t(y,a.current),C&&typeof r=="function"&&r(a.current)},[y]),(0,s.useEffect)(()=>{P&&typeof n=="function"&&n(P,a.current)},[P]);function V(){o.current||(o.current=window.cloudinary),te(()=>{a.current||(a.current=w())})}function _(u,C){if(typeof d=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(d,{method:"POST",body:JSON.stringify({paramsToSign:C})}).then(c=>c.json()).then(({signature:c})=>{u(c)})}function w(){var u;return(u=o.current)==null?void 0:u.createUploadWidget(U,(C,c)=>{typeof C!="undefined"&&A(C),we.includes(c==null?void 0:c.event)&&T(c)})}function D(){a.current||(a.current=w()),a==null||a.current.open(),typeof i=="function"&&i(a.current)}return s.default.createElement(s.default.Fragment,null,typeof e=="function"&&e({cloudinary:o.current,widget:a.current,open:D,results:y,error:P}),s.default.createElement(oe.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onLoad:V,onError:u=>console.error(`Failed to load Cloudinary Upload Widget: ${u.message}`)}))},E=xe;var Ee=({children:e,onClick:r,onError:n,onUpload:i,options:t,signatureEndpoint:l,uploadPreset:d,...m})=>L.default.createElement(L.default.Fragment,null,L.default.createElement(E,{onError:n,onUpload:i,options:t,signatureEndpoint:l,uploadPreset:d},({open:o})=>{function a(I){I.preventDefault(),o(),typeof r=="function"&&r(I)}return L.default.createElement("button",{...m,onClick:a},e||"Upload")})),R=Ee;var p=g(require("react")),re=g(require("next/script")),ne=g(require("next/head")),Le=e=>{let r=(0,p.useRef)(Math.ceil(Math.random()*1e5)),{autoPlay:n="never",colors:i,controls:t=!0,fontFace:l,height:d,id:m,logo:o=!0,loop:a=!1,muted:I=!1,onDataLoad:P,onError:A,onMetadataLoad:y,onPause:T,onPlay:U,onEnded:V,src:_,version:w="1.9.4",width:D}=e,u=(0,p.useRef)(),C=(0,p.useRef)(),c=e.videoRef||C,ie=(0,p.useRef)(),j=e.playerRef||ie,ae=m||`player-${_.replace("/","-")}-${r.current}`,W={error:A,loadeddata:P,loadedmetadata:y,pause:T,play:U,ended:V};function de(h){let x=W[h.type];typeof x=="function"&&x(se())}function le(){if("cloudinary"in window){u.current=window.cloudinary;let h={};typeof o=="boolean"?h.showLogo=o:typeof o=="object"&&(h={...h,showLogo:!0,logoImageUrl:o.imageUrl,logoOnclickUrl:o.onClickUrl});let x={autoplayMode:n,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,controls:t,fontFace:l||"",loop:a,muted:I,publicId:_,secure:!0,...h};typeof i=="object"&&(x.colors=i),j.current=u.current.videoPlayer(c.current,x),Object.keys(W).forEach(B=>{var G;typeof W[B]=="function"&&((G=j.current)==null||G.on(B,de))})}}function se(){return{player:j.current,video:c.current}}return p.default.createElement(p.default.Fragment,null,p.default.createElement(ne.default,null,p.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${w}/dist/cld-video-player.min.css`,rel:"stylesheet"})),p.default.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},p.default.createElement("video",{ref:c,id:ae,className:"cld-video-player cld-fluid",width:D,height:d}),p.default.createElement(re.default,{id:`cloudinary-videoplayer-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${w}/dist/cld-video-player.min.js`,onLoad:le,onError:h=>console.error(`Failed to load Cloudinary Video Player: ${h.message}`)})))},$=Le;0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl});
//# sourceMappingURL=index.js.map